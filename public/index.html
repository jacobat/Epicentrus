<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
	html { height: 100% }
	body { height: 100%; margin: 0px; padding: 0px }
	#map_canvas { height: 100% }
	#sliderContainer {
		position: fixed;
		bottom: 0;
		left: 0;
		width: 100%;
		height: 80px;
		background: grey;
	}
	#infoContainer {
		margin: 0 auto;
		width: 50%;
	}
	#slider {
		width: 70%;
		margin: 10px auto;
	}
</style>
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/base/jquery-ui.css" />
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/jquery-ui.min.js"></script>
<script type="text/javascript">
	var intCol = [	'FFFF00',
					'FFFF00',
					'FFE200',
					'FFC600',
					'FFAA00',
					'FF8D00',
					'FF7100',
					'FF5500',
					'FF3800',
					'FF1C00',
					'FF0000',];
				
	$(function () {

		var resolution = 60*60*1000; // 1 hour
		var minDate = new Date(2011, 2-1, 21, 15, 00); // 2011-02-21T15:00:00+01:00
	    var maxDate = new Date(2011, 2-1, 26, 14, 00); // 2011-02-25T17:00:00+01:00
		var max = Math.floor((maxDate.getTime() - minDate.getTime()) / resolution);
		currentHistoryId = max;
	    $('#slider').slider({
	        max: max,
			value: max,
	        slide: function(event, ui) {
	            var date = new Date(minDate.getTime()+(ui.value*resolution));
	            $('#displayDate').html($.datepicker.formatDate('mm/dd/yy', date)+' '+date.getHours()+':'+date.getMinutes());
				currentHistoryId = ui.value;
				updateMarkers();
	        }
	    });
	});
	
	var markers = [];
	var currentHistoryId;
	var currentThresholdDivider = 1;
	
	function updateMarkers() {
		for (var i in epicenters) {
			var ec = epicenters[i];
			if (epiHistory[ec.tag] != undefined) {
				var hist = epiHistory[ec.tag];
				if (markers[i] != undefined && hist[currentHistoryId] != undefined) {
					var reach = Math.floor(hist[currentHistoryId].reach/currentThresholdDivider);
					var impact = Math.floor(hist[currentHistoryId].impact/currentThresholdDivider);
					if (reach > 10)
						reach = 10;
					if (impact > 10)
						impact = 10;
					
					if (reach > 0 && impact > 0) {
						markers[i].setIcon(new google.maps.MarkerImage('http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld='+reach+'|'+intCol[impact]+'|000000'));
						markers[i].setVisible(true);
					} else {
						markers[i].setVisible(false);
					}
					
				}
			}
		}
	}
	
	function initMap() {
    	var latlng = new google.maps.LatLng(0, 0);
	    var myOptions = {
	      zoom: 2,
	      center: latlng,
	      mapTypeId: google.maps.MapTypeId.ROADMAP
	    };
	    var map = new google.maps.Map(document.getElementById("map_canvas"),
	        myOptions);

		for(var i in epicenters) {
			var ec = epicenters[i];
			(function (i, ec) {
				markers[i] = new google.maps.Marker({
				      position: new google.maps.LatLng(ec.lat, ec.lng), 
				      map: map, 
				      title: ec.name,
				  });
				google.maps.event.addListener(markers[i], 'click', function() {
				    console.log(this);
					console.log(ec);
				});
				updateMarkers();
			})(i, ec);
		}
	}
	
	var epicenters = [
						{
							name: 'StartupWeekend Copenhagen',
							lat: 55.680476,
							lng: 12.524779,
							tag: '#swcph',
						},
						{
							name: 'StartupWeekend Austin',
							lat: 30.283381,
							lng: -97.743988,
							tag: '#swaustin',
						},
						{
							name: 'StartupWeekend Boulder',
							lat: 40.020253,
							lng: -105.268936,
							tag: '#swboulder',
						},
						{
							name: 'StartupWeekend Dublin',
							lat: 53.349937,
							lng: -6.265984,
							tag: '#swdub',
						},
						{
							name: 'StartupWeekend Houston',
							lat: 29.791792,
							lng: -95.386047,
							tag: '#HoustonSW',
						},
						{
							name: 'StartupWeekend San Diego',
							lat: 32.726642,
							lng: -117.154083,
							tag: '#swsd2',
						},
						{
							name: 'StartupWeekend Tunis',
							lat: 34.152727,
							lng: 9.700928,
							tag: '#swtunis',
						},
						{
							name: 'StartupWeekend Des Moine',
							lat: 41.606458,
							lng: -93.608665,
							tag: '#swdsm',
						},
						
					];
					
	var epiHistory = {"#swcph":[{"reach":0,"time":"2011-02-21T15:00:00+01:00","impact":0},{"reach":1,"time":"2011-02-21T23:00:00+01:00","impact":1},{"reach":0,"time":"2011-02-22T09:00:00+01:00","impact":0},{"reach":1,"time":"2011-02-22T11:00:00+01:00","impact":1},{"reach":3,"time":"2011-02-22T12:00:00+01:00","impact":3},{"reach":1,"time":"2011-02-22T16:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-22T17:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-23T09:00:00+01:00","impact":1},{"reach":2,"time":"2011-02-23T12:00:00+01:00","impact":2},{"reach":3,"time":"2011-02-23T13:00:00+01:00","impact":3},{"reach":3,"time":"2011-02-23T16:00:00+01:00","impact":3},{"reach":3,"time":"2011-02-23T17:00:00+01:00","impact":3},{"reach":1,"time":"2011-02-23T22:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-24T09:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-24T10:00:00+01:00","impact":1},{"reach":2,"time":"2011-02-24T11:00:00+01:00","impact":3},{"reach":1,"time":"2011-02-24T14:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-24T15:00:00+01:00","impact":1},{"reach":2,"time":"2011-02-24T18:00:00+01:00","impact":2},{"reach":7,"time":"2011-02-24T19:00:00+01:00","impact":8},{"reach":1,"time":"2011-02-24T20:00:00+01:00","impact":1},{"reach":3,"time":"2011-02-24T22:00:00+01:00","impact":3},{"reach":1,"time":"2011-02-25T05:00:00+01:00","impact":1},{"reach":3,"time":"2011-02-25T08:00:00+01:00","impact":3},{"reach":6,"time":"2011-02-25T09:00:00+01:00","impact":7},{"reach":3,"time":"2011-02-25T10:00:00+01:00","impact":3},{"reach":5,"time":"2011-02-25T11:00:00+01:00","impact":5},{"reach":7,"time":"2011-02-25T12:00:00+01:00","impact":7},{"reach":7,"time":"2011-02-25T13:00:00+01:00","impact":7},{"reach":2,"time":"2011-02-25T14:00:00+01:00","impact":2},{"reach":6,"time":"2011-02-25T15:00:00+01:00","impact":6},{"reach":12,"time":"2011-02-25T16:00:00+01:00","impact":14},{"reach":16,"time":"2011-02-25T17:00:00+01:00","impact":21},{"reach":14,"time":"2011-02-25T18:00:00+01:00","impact":17},{"reach":17,"time":"2011-02-25T19:00:00+01:00","impact":23},{"reach":13,"time":"2011-02-25T20:00:00+01:00","impact":14},{"reach":8,"time":"2011-02-25T21:00:00+01:00","impact":9},{"reach":6,"time":"2011-02-25T22:00:00+01:00","impact":7},{"reach":6,"time":"2011-02-25T23:00:00+01:00","impact":8},{"reach":6,"time":"2011-02-26T00:00:00+01:00","impact":6},{"reach":2,"time":"2011-02-26T01:00:00+01:00","impact":2},{"reach":1,"time":"2011-02-26T02:00:00+01:00","impact":2},{"reach":1,"time":"2011-02-26T05:00:00+01:00","impact":1},{"reach":2,"time":"2011-02-26T06:00:00+01:00","impact":2},{"reach":7,"time":"2011-02-26T08:00:00+01:00","impact":7},{"reach":5,"time":"2011-02-26T09:00:00+01:00","impact":7},{"reach":6,"time":"2011-02-26T10:00:00+01:00","impact":7},{"reach":9,"time":"2011-02-26T11:00:00+01:00","impact":9},{"reach":21,"time":"2011-02-26T12:00:00+01:00","impact":26},{"reach":13,"time":"2011-02-26T13:00:00+01:00","impact":14},{"reach":2,"time":"2011-02-26T14:00:00+01:00","impact":2},{"reach":7,"time":"2011-02-26T15:00:00+01:00","impact":8}],
	"#swaustin":[{"reach":8,"time":"2011-02-23T21:00:00+01:00","impact":8},{"reach":2,"time":"2011-02-23T23:00:00+01:00","impact":2},{"reach":3,"time":"2011-02-24T00:00:00+01:00","impact":3},{"reach":1,"time":"2011-02-24T01:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-24T02:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-24T03:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-24T04:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-24T10:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-24T15:00:00+01:00","impact":1},{"reach":2,"time":"2011-02-24T16:00:00+01:00","impact":2},{"reach":1,"time":"2011-02-24T19:00:00+01:00","impact":1},{"reach":4,"time":"2011-02-25T00:00:00+01:00","impact":5},{"reach":4,"time":"2011-02-25T01:00:00+01:00","impact":4},{"reach":1,"time":"2011-02-25T02:00:00+01:00","impact":1},{"reach":2,"time":"2011-02-25T03:00:00+01:00","impact":2},{"reach":2,"time":"2011-02-25T04:00:00+01:00","impact":2},{"reach":2,"time":"2011-02-25T05:00:00+01:00","impact":2},{"reach":2,"time":"2011-02-25T07:00:00+01:00","impact":2},{"reach":14,"time":"2011-02-25T17:00:00+01:00","impact":14},{"reach":1,"time":"2011-02-25T18:00:00+01:00","impact":1},{"reach":2,"time":"2011-02-25T19:00:00+01:00","impact":2},{"reach":1,"time":"2011-02-25T20:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-25T22:00:00+01:00","impact":1},{"reach":4,"time":"2011-02-25T23:00:00+01:00","impact":4},{"reach":3,"time":"2011-02-26T00:00:00+01:00","impact":4},{"reach":7,"time":"2011-02-26T02:00:00+01:00","impact":11},{"reach":3,"time":"2011-02-26T03:00:00+01:00","impact":3},{"reach":5,"time":"2011-02-26T04:00:00+01:00","impact":6},{"reach":2,"time":"2011-02-26T05:00:00+01:00","impact":2},{"reach":2,"time":"2011-02-26T06:00:00+01:00","impact":2},{"reach":1,"time":"2011-02-26T07:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-26T10:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-26T11:00:00+01:00","impact":1},{"reach":1,"time":"2011-02-26T12:00:00+01:00","impact":1},{"reach":2,"time":"2011-02-26T15:00:00+01:00","impact":2}]};

</script>
</head>
<body onload="initMap();">
 	<div id="map_canvas" style="width:100%; height:100%"></div> 
	<div id="sliderContainer">
		<div id="slider"></div>
		<div id="infoContainer">Date: <span id="displayDate"></span></div>
	</div>
</body>
</html>